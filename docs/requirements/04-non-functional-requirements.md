# 5. 非機能要件

## 5.1 セキュリティ要件

### NFR-1.1 データ保護
- すべての機密情報は暗号化して保存すること
- 暗号化キーはコードから分離して管理すること
- トークンはハッシュ化して保存すること

### NFR-1.2 認証・認可
- Passkey (WebAuthn) による強固な多要素認証を実装すること
- トークンベースのアクセス制御を実装すること
- ユーザーごとに機密情報を完全に分離すること
- トークン数の制限（設定可能、デフォルト: 5 個）を実装すること

### NFR-1.3 機密情報の取り扱い
- ログに機密情報 (値、トークン、パスワード) を記録しないこと
- エラーメッセージから機密情報を除外すること
- メモリ上の機密情報は使用後速やかに破棄すること

## 5.2 保守性要件

### NFR-2.1 ログ
- 構造化ログを出力すること
- ログレベルを適切に使い分けること

### NFR-2.2 モニタリング
- 以下のメトリクスを記録すること:
  - トークン発行数
  - 機密情報アクセス数
  - エラー発生率

### NFR-2.3 アラート
- 以下の条件でログに警告を記録すること:
  - 連続する認証失敗 (5 回以上)
  - 異常なアクセスパターン
  - システムエラーの発生

### NFR-2.4 エラーハンドリング
- 一時的なエラー（データベース接続失敗など）は自動的にリトライすること
- リトライ回数と間隔は設定可能とすること

## 5.3 互換性要件

### NFR-3.1 OS 互換性
- Linux、macOS、Windows で動作すること

### NFR-3.2 パッケージ管理
- 標準的なパッケージマネージャーで配布可能であること
